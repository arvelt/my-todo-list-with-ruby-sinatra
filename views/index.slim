doctype html
html
  head
    link href="/css/bootstrap.min.css" rel="stylesheet"
    script src="/js/bootstrap.min.js"
    script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"
    script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"
    script src="/js/jquery-ui-timepicker-addon.js"
    script src="/js/jquery-ui-sliderAccess.js"
    script src="/js/bootstrap-select.min.js"
    link rel="stylesheet" type="text/css" href="/css/jquery-ui-1.10.0.custom.min.css"
    link rel="stylesheet" type="text/css" href="/css/jquery-ui-timepicker-addon.css"
    link rel="stylesheet" type="text/css" href="/css/bootstrap-select.min.css"
    javascript:
      function doAddTask(){
    	  $.ajax({
    	    url: '/add',
    	    type: 'POST',
    	    data: {
       	        "send_content" : $('#send_content').val() ,
       	        "send_duedatetime" : $('#send_duedatetime').val() 
    	    },
    	    dataType: 'html',
    	    success: function( data ) {
				    $('#taskslist').html(data);
				    setInputDateTimePicker();
    	    },
    	    error: function( data ) {
    	    },
    	    complete: function( data ) {
    	    }
    	  });
      }
    javascript:
      function doUpdateTask(key){
        var id_status = "status_"+key;
        var id_content = "content_"+key;
        var id_datetime = "due_date_"+key;
        $.ajax({
          url: '/update',
          type: 'POST',
          data: {
                "key" : key ,
                "status" : $('#'+id_status).val() ,
                "content" : $('#'+id_content).val() ,
                "due_date" : $('#'+id_datetime).val()
          },
          dataType: 'html',
          success: function( data ) {
          $('#taskslist').html(data);
          setInputDateTimePicker();
          },
          error: function( data ) {
          },
          complete: function( data ) {
          }
        });
      }
    javascript:
      function doDeleteTask(key){
      	$.ajax({
      	    url: '/delete',
      	    type: 'POST',
      	    data: {
         	        "key" : key 
      	    },
      	    dataType: 'html',
      	    success: function( data ) {
  				$('#taskslist').html(data);
  				setInputDateTimePicker();
      	    },
      	    error: function( data ) {
      	    },
      	    complete: function( data ) {
      	    }
        	});
        }
    javascript:
      function setInputDateTimePicker(){
        var datetime = document.getElementsByName("datetime");
        jQuery.each(datetime, function() {
          $("#" + this.id).datetimepicker(
            {
              dateFormat: 'yy-mm-dd',
              timeFormat: 'HH:mm'
            }
          );
        })
      }
      window.onload = function(){
        setInputDateTimePicker();
      }

  body
    div class="container"
      form id="form" action="" method="post"
        span class="label label-info" Todoの追加

        div class="row"
          div class="span8"
            table id="input_task" class="table table-striped"
              thead
                th 
                th 期限
                th 内容
              tbody
                tr
                  td
                    input type="button" class="btn" value="追加" onClick="doAddTask()"
                  td
                    input type="text" id="send_duedatetime"
                  td
                    input type="text" id="send_content"
                    
          div class="span4"

        div class="row"
          div class="span12"        
            div id="taskslist"
              - if @todos.length != 0
                span class="label label-info" Todo一覧
                table id="tasks" class="table table-striped"
                  - if @todos.length != 0
                    thead 
                      th 
                      th 
                      th 状況
                      th 期限
                      th 内容
                
                  tbody
                    - for todo in @todos 
                      tr
                        td 
                          input type="button" class="btn" value="更新" onClick="doUpdateTask(#{todo.id})"
                        td 
                          input type="button" class="btn" value="削除" onClick="doDeleteTask(#{todo.id})"
                        td
                          select id="status_#{todo.id}" name="status" 
                            -  if  todo.status == 1
                              option value="1" selected="selected"  未完了 
                            -  else
                              option value="1" 未完了 
                            -  if  todo.status == 2
                              option value="2" selected="selected"  完了 
                            -  else
                              option value="2" 完了
                        td
                          - if todo.due_date.nil?
                            input type="text" name="datetime" id="due_date_#{todo.id}" value="#{todo.due_date}"
                          - else
                            input type="text" name="datetime" id="due_date_#{todo.id}" value="#{todo.due_date.strftime("%Y-%m-%d %H:%M")}"
                        td
                          input type="text" id="content_#{todo.id}" value="#{todo.content}"

    javascript:
      $(function(){
        $("#send_duedatetime").datetimepicker(
          {
            dateFormat: 'yy-mm-dd',
            timeFormat: 'HH:mm'
          }
        );
      });
      